<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>docker ç¼–å†™æ„å»ºé•œåƒå…³é”®å­— | çŸ¥è¯†çš„æ¬è¿å·¥</title><meta name="author" content="Nebulaoc,2018212212275@stu.hznu.edu.cn"><meta name="copyright" content="Nebulaoc"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Dockerfile reference   Docker build å‘½ä»¤æ ¹æ® Dockerfile æ–‡ä»¶å’Œä¸Šä¸‹æ–‡æ„å»ºä¸€ä¸ªæ˜ åƒã€‚   æ„å»ºç”± Docker å®ˆæŠ¤è¿›ç¨‹è¿è¡Œï¼Œè€Œä¸æ˜¯ç”± CLI è¿è¡Œã€‚&#x3D;&#x3D;æ„å»ºè¿‡ç¨‹è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯å°†æ•´ä¸ªä¸Šä¸‹æ–‡(é€’å½’åœ°)å‘é€åˆ°å®ˆæŠ¤è¿›ç¨‹&#x3D;&#x3D;ã€‚   åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ&#x3D;&#x3D;æœ€å¥½ä»ä¸€ä¸ªç©ºç›®å½•ä½œä¸ºä¸Šä¸‹æ–‡å¼€å§‹&#x3D;&#x3D;ï¼Œå¹¶å°† Dockerfile ä¿å­˜åœ¨è¯¥ç›®å½•ä¸­ã€‚åªæ·»åŠ æ„å»º Dockerfi">
<meta property="og:type" content="article">
<meta property="og:title" content="docker ç¼–å†™æ„å»ºé•œåƒå…³é”®å­—">
<meta property="og:url" content="https://nebulaoc.cn/2021/07/09/docker-%E7%BC%96%E5%86%99%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F%E5%85%B3%E9%94%AE%E5%AD%97/index.html">
<meta property="og:site_name" content="çŸ¥è¯†çš„æ¬è¿å·¥">
<meta property="og:description" content="Dockerfile reference   Docker build å‘½ä»¤æ ¹æ® Dockerfile æ–‡ä»¶å’Œä¸Šä¸‹æ–‡æ„å»ºä¸€ä¸ªæ˜ åƒã€‚   æ„å»ºç”± Docker å®ˆæŠ¤è¿›ç¨‹è¿è¡Œï¼Œè€Œä¸æ˜¯ç”± CLI è¿è¡Œã€‚&#x3D;&#x3D;æ„å»ºè¿‡ç¨‹è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯å°†æ•´ä¸ªä¸Šä¸‹æ–‡(é€’å½’åœ°)å‘é€åˆ°å®ˆæŠ¤è¿›ç¨‹&#x3D;&#x3D;ã€‚   åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ&#x3D;&#x3D;æœ€å¥½ä»ä¸€ä¸ªç©ºç›®å½•ä½œä¸ºä¸Šä¸‹æ–‡å¼€å§‹&#x3D;&#x3D;ï¼Œå¹¶å°† Dockerfile ä¿å­˜åœ¨è¯¥ç›®å½•ä¸­ã€‚åªæ·»åŠ æ„å»º Dockerfi">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg">
<meta property="article:published_time" content="2021-07-09T02:06:27.000Z">
<meta property="article:modified_time" content="2021-07-09T02:08:21.700Z">
<meta property="article:author" content="Nebulaoc">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><link rel="shortcut icon" href="/personalData/img/profile/head.jpg"><link rel="canonical" href="https://nebulaoc.cn/2021/07/09/docker-%E7%BC%96%E5%86%99%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F%E5%85%B3%E9%94%AE%E5%AD%97/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.js" defer></script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"5TUJ5I5OU2","apiKey":"38208565045908dbfb5f9346b8c6fd42","indexName":"Lin02993_Lin","hits":{"per_page":6},"languages":{"input_placeholder":"æœç´¢æ–‡ç« ","hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼Œç”¨æ—¶ ${time} æ¯«ç§’"}},
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: {"limitCount":50,"languages":{"author":"ä½œè€…: Nebulaoc","link":"é“¾æ¥: ","source":"æ¥æº: çŸ¥è¯†çš„æ¬è¿å·¥","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-07-09 10:08:21'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><link rel="stylesheet" href="/css/custom.css"  media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">åŠ è½½ä¸­...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/personalData/img/profile/head.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">8</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">14</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">4</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">çŸ¥è¯†çš„æ¬è¿å·¥</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">docker ç¼–å†™æ„å»ºé•œåƒå…³é”®å­—</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2021-07-09T02:06:27.000Z" title="å‘è¡¨äº 2021-07-09 10:06:27">2021-07-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2021-07-09T02:08:21.700Z" title="æ›´æ–°äº 2021-07-09 10:08:21">2021-07-09</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">6.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>22åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="docker ç¼–å†™æ„å»ºé•œåƒå…³é”®å­—"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Dockerfile-reference"><a href="#Dockerfile-reference" class="headerlink" title="Dockerfile reference"></a><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/">Dockerfile reference</a></h1><ul>
<li>  Docker build å‘½ä»¤æ ¹æ® Dockerfile æ–‡ä»¶å’Œä¸Šä¸‹æ–‡æ„å»ºä¸€ä¸ªæ˜ åƒã€‚</li>
<li>  æ„å»ºç”± Docker å®ˆæŠ¤è¿›ç¨‹è¿è¡Œï¼Œè€Œä¸æ˜¯ç”± CLI è¿è¡Œã€‚==æ„å»ºè¿‡ç¨‹è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯å°†æ•´ä¸ªä¸Šä¸‹æ–‡(é€’å½’åœ°)å‘é€åˆ°å®ˆæŠ¤è¿›ç¨‹==ã€‚</li>
<li>  åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ==æœ€å¥½ä»ä¸€ä¸ªç©ºç›®å½•ä½œä¸ºä¸Šä¸‹æ–‡å¼€å§‹==ï¼Œå¹¶å°† Dockerfile ä¿å­˜åœ¨è¯¥ç›®å½•ä¸­ã€‚åªæ·»åŠ æ„å»º Dockerfile æ‰€éœ€çš„æ–‡ä»¶ã€‚</li>
</ul>
<p>âš ï¸ï¼š<strong>Warning</strong></p>
<blockquote>
<p>  ä¸è¦ä½¿ç”¨æ ¹ç›®å½•ä½œä¸ºæ„å»ºä¸‹æ–‡çš„ PATH â€“ ä¼šå¯¼è‡´æ„å»ºè¿‡ç¨‹ä¸­å»ä¼ è¾“ç¡¬ä»¶ä¸­çš„æ‰€æœ‰å†…å®¹å» Docker daemon (å®ˆæŠ¤è¿›ç¨‹)</p>
</blockquote>
<h2 id="Usage-ç”¨æ³•"><a href="#Usage-ç”¨æ³•" class="headerlink" title="Usage ç”¨æ³•"></a>Usage ç”¨æ³•</h2><p>åœ¨ build context ä½¿ç”¨æ–‡ä»¶ï¼ŒDockerfile å¼•ç”¨æŒ‡ä»¤ä¸­æŒ‡å®šçš„æ–‡ä»¶</p>
<ul>
<li>  ä¾‹å¦‚ ==COPY== æŒ‡ä»¤ã€‚è‹¥è¦æé«˜ç”Ÿæˆçš„æ€§èƒ½ï¼Œæ·»åŠ  .dockerignore æ–‡ä»¶(exclude file and directory)ç§»åˆ°ä¸Šä¸‹æ–‡ä»¶çš„ç›®å½•</li>
</ul>
<p>ä¼ ç»Ÿçš„ï¼ŒDockerfile ä½äºä¸Šä¸‹æ–‡çš„æ ¹éƒ¨ã€‚åœ¨ docker æ„å»ºä¸­ä½¿ç”¨-f æ ‡å¿—æŒ‡å‘æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä»»ä½•ä½ç½®çš„ Dockerfileã€‚</p>
<ul>
<li>```bash<br>  docker build -f /path/to/a/Dockerfile .  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">æ ¹æ® Dockerfile æ–‡ä»¶æ„å»ºé•œåƒï¼ŒåŒæ—¶æŒ‡å®š å­˜å‚¨åº“å’Œæ ‡ç­¾æ¥ä¿å­˜æ–°æ˜ åƒ</span><br><span class="line"></span><br><span class="line">-   &#96;&#96;&#96;bash</span><br><span class="line">    docker build  -t shykes&#x2F;myapp .</span><br></pre></td></tr></table></figure></li>
</ul>
<p>è¦åœ¨æ„å»ºä¹‹åå°†å›¾åƒæ ‡è®°ä¸ºå¤šä¸ªå­˜å‚¨åº“ï¼Œè¯·åœ¨è¿è¡Œæ„å»ºå‘½ä»¤æ—¶æ·»åŠ  multiple-t å‚æ•°:</p>
<ul>
<li>```bash<br>  docker build -t shykes/myapp:1.0.2 -t shykes/myapp:latest .  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">åœ¨ Docker å®ˆæŠ¤è¿›ç¨‹è¿è¡Œ Dockerfile ä¸­çš„æŒ‡ä»¤ä¹‹å‰ï¼Œå®ƒä¼šå¯¹ Dockerfile è¿›è¡Œåˆæ­¥éªŒè¯ï¼Œå¦‚æœè¯­æ³•ä¸æ­£ç¡®ï¼Œåˆ™è¿”å›ä¸€ä¸ªé”™è¯¯:</span><br><span class="line"></span><br><span class="line">ä¾‹å­ï¼š</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;bash</span><br><span class="line"> docker build -t test&#x2F;myapp .</span><br><span class="line"> [internal] load build definition from Dockerfile                       0.1s</span><br><span class="line"> &#x3D;&gt; transferring dockerfile: 60B                                        0.0s</span><br><span class="line"> [internal] load .dockerignore                                          0.1s</span><br><span class="line"> &#x3D;&gt; transferring context: 2B                                            0.0s</span><br><span class="line"> error: ......</span><br></pre></td></tr></table></figure></li>
</ul>
<p>Docker å®ˆæŠ¤è¿›ç¨‹é€æ¡è¿è¡Œ Dockerfile ä¸­çš„æŒ‡ä»¤ï¼Œåœ¨æœ€ç»ˆè¾“å‡ºæ–°æ˜ åƒçš„ ID ä¹‹å‰ï¼Œå¿…è¦æ—¶å°†æ¯æ¡æŒ‡ä»¤çš„ç»“æœæäº¤åˆ°æ–°æ˜ åƒä¸­ã€‚Docker å®ˆæŠ¤è¿›ç¨‹å°†è‡ªåŠ¨æ¸…é™¤æ‚¨å‘é€çš„ä¸Šä¸‹æ–‡ã€‚</p>
<img src="https://cdn.jsdelivr.net/gh/PictureBed/blog0-img/Dockerfile ç¼–å†™æ„å»ºé•œåƒ.assets/image-20210514115658168.png" alt="image-20210514115658168" style="zoom:75%;" />

<p>è¯·æ³¨æ„ï¼Œ==æ¯æ¡æŒ‡ä»¤éƒ½æ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œå¹¶ä¸”ä¼šåˆ›å»ºä¸€ä¸ªæ–°æ˜ åƒï¼ˆåŒ…æ‹¬å‰ä¸€ä¸ªæ˜ åƒçš„å†…å®¹ï¼‰==â€”â€”å› æ­¤ RUN cd/tmp ä¸ä¼šå¯¹ä¸‹ä¸€æ¡æŒ‡ä»¤äº§ç”Ÿä»»ä½•å½±å“ã€‚</p>
<p>==åªè¦æœ‰å¯èƒ½ï¼ŒDocker å°±ä¼šä½¿ç”¨ä¸€ä¸ªæ„å»ºç¼“å­˜æ¥æ˜¾è‘—åŠ å¿« Docker æ„å»ºè¿‡ç¨‹ã€‚==è¿™æ˜¯ç”±æ§åˆ¶å°è¾“å‡ºä¸­çš„ç¼“å­˜æ¶ˆæ¯æŒ‡å‡ºçš„ã€‚(æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ Dockerfile æœ€ä½³å®è·µæŒ‡å—:)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŠ ä¸€å±‚ å­˜å‚¨åº“å’Œæ ‡ç­¾ -- å°†æ„å»ºæ–°çš„é•œåƒ</span></span><br><span class="line">docker build -t svendowideit/ambassador .</span><br><span class="line"> </span><br><span class="line"><span class="comment"># ä» Dockerfile åŠ è½½æ„å»ºå®šä¹‰</span></span><br><span class="line"> [internal] load build definition from Dockerfile                       0.1s</span><br><span class="line"> =&gt; transferring dockerfile: 286B                                       0.0s</span><br><span class="line"> [internal] load .dockerignore                                          0.1s</span><br><span class="line"> =&gt; transferring context: 2B                                            0.0s</span><br><span class="line"> [internal] load metadata <span class="keyword">for</span> docker.io/library/alpine:3.2              0.4s</span><br><span class="line"> <span class="comment"># æ„å»ºç¼“å­˜ - æ„å»ºæ–°é•œåƒæ—¶ï¼Œä»ç¼“å­˜è¯»å–å‰é¢çš„é•œåƒå±‚ - è€—è´¹äº‹ä»¶ 0 s</span></span><br><span class="line"> CACHED [1/2] FROM docker.io/library/alpine:3.2@sha256:e9a2035f9d0d7ce  0.0s</span><br><span class="line"> CACHED [2/2] RUN apk add --no-cache socat                              0.0s</span><br><span class="line"> exporting to image                                                     0.0s</span><br><span class="line"> =&gt; exporting layers                                                    0.0s</span><br><span class="line"> =&gt; writing image sha256:1affb80ca37018ac12067fa2af38cc5bcc2a8f09963de  0.0s</span><br><span class="line"> =&gt; naming to docker.io/svendowideit/ambassador                         0.0s</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>é»˜è®¤æƒ…å†µï¼Œæ„å»ºæ–°çš„é•œåƒéƒ½æ˜¯åŸºäºç¼“å­˜æ„å»ºçš„(ç¼“å­˜æŒ‡çš„æ˜¯ä»¥å‰æ„å»ºçš„é•œåƒå±‚)</p>
<p><code>-- cache-from</code>  é€‰é¡¹è¿˜å…è®¸æ‚¨ä½¿ç”¨é€šè¿‡æ˜ åƒæ³¨å†Œè¡¨(image registry)åˆ†å‘çš„æ„å»ºç¼“å­˜ï¼Œè¯¥æ„å»ºç¼“å­˜å¼•ç”¨äº† <code>docker build</code> å‘½ä»¤å¼•ç”¨ä¸­==æŒ‡å®šçš„å¤–éƒ¨ç¼“å­˜æºéƒ¨åˆ†ã€‚==</p>
<p>å®Œæˆæ„å»ºåï¼Œå°±å¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/scan/"><code>docker scan</code></a> æŸ¥çœ‹æ‰«æå›¾åƒï¼Œå¹¶å°†å›¾åƒæ¨é€åˆ° Docker Hubï¼ˆ<a target="_blank" rel="noopener" href="https://docs.docker.com/docker-hub/repos/">pushing your image to docker hub</a> ï¼‰ã€‚</p>
<p>(<code>docker scan hello-world</code>)</p>
<h2 id="BuildKit"><a href="#BuildKit" class="headerlink" title="BuildKit"></a>BuildKit</h2><p>â€“ æ„å»ºå·¥å…·åŒ…</p>
<p>Docker 18.09 ç‰ˆæœ¬ä»¥åï¼Œèµ·ä¸€ä¸ªæ–°çš„åç«¯(backend)æ‰§è¡Œæ‰€æœ‰ç”± moby/buildkit é¡¹ç›®æä¾›çš„æ„å»ºã€‚</p>
<p>å®éªŒæ€§ï¼Œæš‚ä¸è€ƒè™‘ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p>
<h2 id="Format-æ ¼å¼"><a href="#Format-æ ¼å¼" class="headerlink" title="Format æ ¼å¼"></a>Format æ ¼å¼</h2><p>Dockerfile æ ¼å¼ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Comment</span></span><br><span class="line">INSTRUCTION arguments</span><br></pre></td></tr></table></figure>

<p>è¯¥æŒ‡ä»¤å¤§å°å†™ä¸æ•æ„Ÿã€‚ä½†æ˜¯ï¼Œçº¦å®šä½¿ç”¨==å¤§å†™==å½¢å¼ï¼Œä»¥ä¾¿æ›´å®¹æ˜“åœ°ä¸å‚æ•°åŒºåˆ†å¼€ã€‚</p>
<hr>
<p>Docker æŒ‰é¡ºåºåœ¨ Dockerfile ä¸­è¿è¡ŒæŒ‡ä»¤ã€‚<strong>Dockerfile å¿…é¡»ä»¥ FROM æŒ‡ä»¤å¼€å¤´</strong>ã€‚</p>
<p>This may be after <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/#parser-directives">parser directives</a>(è§£æå™¨æŒ‡ä»¤), <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/#format">comments</a>(æ³¨é‡Š), and globally scoped <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/#arg">ARGs</a>(ç”¨ä½œ FROM è¡Œçš„å‚æ•°). </p>
<p>FROM ä¹‹å‰åªèƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ª ARG æŒ‡ä»¤ï¼Œè¿™äº›æŒ‡ä»¤å£°æ˜ Dockerfile ä¸­ FROM è¡Œä¸­ä½¿ç”¨çš„å‚æ•°ã€‚</p>
<p>==Docker å°†ä»¥ # å¼€å¤´çš„è¡Œè§†ä¸ºæ³¨é‡Šï¼Œé™¤éè¯¥è¡Œæ˜¯æœ‰æ•ˆçš„è§£æå™¨æŒ‡ä»¤ã€‚ä¸€è¡Œä¸­å…¶ä»–ä»»ä½•åœ°æ–¹çš„ # æ ‡è®°éƒ½è¢«è§†ä¸ºå‚æ•°ã€‚è¿™å…è®¸è¿™æ ·çš„é™ˆè¿°:==</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Comment</span></span><br><span class="line">RUN <span class="built_in">echo</span> <span class="string">&#x27;we are running some # of cool things&#x27;</span></span><br></pre></td></tr></table></figure>

<blockquote>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RUN <span class="built_in">echo</span> hello \</span><br><span class="line">world</span><br></pre></td></tr></table></figure>

<p>  æ³¨é‡Šä¸­ä¸æ”¯æŒè¡Œç»§ç»­ â€“ \</p>
</blockquote>
<h2 id="Parser-directives-è§£æå™¨æŒ‡ä»¤"><a href="#Parser-directives-è§£æå™¨æŒ‡ä»¤" class="headerlink" title="Parser directives è§£æå™¨æŒ‡ä»¤"></a>Parser directives è§£æå™¨æŒ‡ä»¤</h2><p>è§£æå™¨æŒ‡ä»¤æ˜¯å¯é€‰çš„ï¼Œå®ƒå½±å“ Dockerfile ä¸­åç»­è¡Œçš„å¤„ç†æ–¹å¼ã€‚==è§£æå™¨æŒ‡ä»¤ä¸å‘æ„å»ºæ·»åŠ å±‚ï¼Œä¹Ÿä¸ä¼šæ˜¾ç¤ºä¸ºæ„å»ºæ­¥éª¤ã€‚==</p>
<p>è§£æå™¨æŒ‡ä»¤ä½œä¸ºç‰¹æ®Šç±»å‹çš„æ³¨é‡Š ä»¥ # directive = value çš„å½¢å¼ç¼–å†™ã€‚å•ä¸ªæŒ‡ä»¤åªèƒ½ä½¿ç”¨ä¸€æ¬¡ã€‚</p>
<p>==å¤„ç†å®Œæ³¨é‡Šã€ç©ºè¡Œæˆ–ç”Ÿæˆå™¨æŒ‡ä»¤åï¼ŒDocker ä¸å†æŸ¥æ‰¾è§£æå™¨æŒ‡ä»¤ã€‚==ç›¸åï¼Œå®ƒå°†ä»»ä½•æ ¼å¼åŒ–ä¸ºè§£æå™¨æŒ‡ä»¤çš„ä¸œè¥¿è§†ä¸ºæ³¨é‡Šï¼Œå¦‚æœå®ƒå¯èƒ½æ˜¯è§£æå™¨æŒ‡ä»¤ï¼Œåˆ™ä¸å°è¯•éªŒè¯å®ƒã€‚==å› æ­¤ï¼Œæ‰€æœ‰è§£æå™¨æŒ‡ä»¤éƒ½å¿…é¡»ä½äº Dockerfile çš„é¡¶éƒ¨ã€‚==</p>
<p>ğŸ’¡ï¼šåšå®Œä¸‰ä¸ªæ­¥éª¤åï¼Œå³ä½¿é‡åˆ°è§£æå™¨æŒ‡ä»¤æ ¼å¼ï¼Œä¹Ÿä¼šå°†å…¶è§†ä½œæ³¨é‡Š</p>
<p>å„ç§**<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/#parser-directives">æ— æ•ˆæŒ‡ä»¤ä¾‹å­</a>**</p>
<h3 id="syntax-è¯­æ³•"><a href="#syntax-è¯­æ³•" class="headerlink" title="syntax è¯­æ³•"></a>syntax è¯­æ³•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># syntax=[remote image reference]</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªç‰¹æ€§==åªæœ‰åœ¨ä½¿ç”¨ BuildKit åç«¯æ—¶æ‰å¯ç”¨==ï¼Œè€Œåœ¨ä½¿ç”¨ç»å…¸çš„æ„å»ºå™¨åç«¯æ—¶ä¼šè¢«å¿½ç•¥ã€‚</p>
<h3 id="Environment-replacement"><a href="#Environment-replacement" class="headerlink" title="Environment replacement"></a>Environment replacement</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FROM busyboxENV FOO=/barWORKDIR <span class="variable">$&#123;FOO&#125;</span>   <span class="comment"># WORKDIR /barADD . $FOO       # ADD . /barCOPY \$FOO /quux # COPY $FOO /quux</span></span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢çš„ Dockerfile ä¸­çš„æŒ‡ä»¤åˆ—è¡¨æ”¯æŒç¯å¢ƒå˜é‡:</p>
<ul>
<li>  <code>ADD</code></li>
<li>  <code>COPY</code></li>
<li>  <code>ENV</code></li>
<li>  <code>EXPOSE</code></li>
<li>  <code>FROM</code></li>
<li>  <code>LABEL</code></li>
<li>  <code>STOPSIGNAL</code></li>
<li>  <code>USER</code></li>
<li>  <code>VOLUME</code></li>
<li>  <code>WORKDIR</code></li>
<li>  <code>ONBUILD</code> (when combined with one of the supported instructions above) (å½“ä¸ä¸Šé¢æ”¯æŒçš„æŒ‡ä»¤ä¹‹ä¸€ç»“åˆæ—¶)</li>
</ul>
<blockquote>
<p>  ç¯å¢ƒå˜é‡æ›¿æ¢å°†åœ¨æ•´ä¸ªæŒ‡ä»¤ä¸­å¯¹æ¯ä¸ªå˜é‡ä½¿ç”¨ç›¸åŒçš„å€¼ã€‚æ¢å¥è¯è¯´ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ENV abc=helloENV abc=<span class="built_in">bye</span> def=<span class="variable">$abcENV</span> ghi=<span class="variable">$abc</span></span><br></pre></td></tr></table></figure>

<p>å°†å¯¼è‡´ def çš„å€¼æ˜¯ helloï¼Œè€Œä¸æ˜¯ byeã€‚ç„¶è€Œï¼Œghi å°†æœ‰ä¸€ä¸ª bye çš„å€¼ï¼Œå› ä¸ºå®ƒä¸æ˜¯å°† abc è®¾ç½®ä¸º bye çš„åŒä¸€ä¸ªæŒ‡ä»¤çš„ä¸€éƒ¨åˆ†ã€‚</p>
<h2 id="dockerignore-file-ğŸ”—"><a href="#dockerignore-file-ğŸ”—" class="headerlink" title=".dockerignore file ğŸ”—"></a><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/#dockerignore-file">.dockerignore file ğŸ”—</a></h2><p>åœ¨ docker CLI å°†ä¸Šä¸‹æ–‡å‘é€ç»™ docker å®ˆæŠ¤è¿›ç¨‹ä¹‹å‰ï¼Œå®ƒä¼šåœ¨ä¸Šä¸‹æ–‡çš„æ ¹ç›®å½•ä¸­æŸ¥æ‰¾ä¸€ä¸ªåä¸º .dockerignore æ–‡ä»¶ã€‚</p>
<p>å¦‚æœæ­¤æ–‡ä»¶å­˜åœ¨ï¼ŒCLI å°†ä¿®æ”¹ä¸Šä¸‹æ–‡ä»¥æ’é™¤ä¸å…¶ä¸­æ¨¡å¼åŒ¹é…çš„æ–‡ä»¶å’Œç›®å½•ã€‚</p>
<p>è¿™æœ‰åŠ©äºé¿å…ä¸å¿…è¦åœ°å‘å®ˆæŠ¤è¿›ç¨‹å‘é€å¤§å‹æˆ–æ•æ„Ÿçš„æ–‡ä»¶å’Œç›®å½•ï¼Œå¹¶å¯èƒ½ä½¿ç”¨ ADD æˆ– COPY å°†å®ƒä»¬æ·»åŠ åˆ°æ˜ åƒä¸­ã€‚</p>
<hr>
<p>è¿™ä¸ª CLI (command-line) å°† .dockerignore æ–‡ä»¶è§£é‡Šä¸º ç±»ä¼¼äº Unix shell çš„ globs æ–‡ä»¶çš„ä»¥è¡Œåˆ†éš”çš„æ¨¡å¼åˆ—è¡¨ã€‚</p>
<p>ä¸ºäº†è¿›è¡ŒåŒ¹é…ï¼Œä¸Šä¸‹æ–‡çš„æ ¹ç›®å½•è¢«è®¤ä¸ºæ˜¯å·¥ä½œç›®å½•å’Œæ ¹ç›®å½•ã€‚</p>
<p>ä¾‹å¦‚ï¼š <code>/foo/bar</code> and <code>foo/bar</code>  æ’é™¤æ¥ PATH çš„ foo å­ç›®å½•ä¸­çš„ä¸€ä¸ªåä¸º bar çš„æ–‡ä»¶æˆ–ç›®å½•</p>
<hr>
<p>å¦‚æœæœ‰ä¸€è¡Œã€‚Dockerignore file ä»¥ç¬¬1åˆ—ä¸­çš„ # å¼€å§‹ï¼Œç„¶åè¿™ä¸€è¡Œè¢«è§†ä¸ºæ³¨é‡Šï¼Œåœ¨ CLI è§£é‡Šä¹‹å‰è¢«å¿½ç•¥ã€‚</p>
<p>ä¾‹å­ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># comment*/temp**/*/temp*temp?</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">Rule è§„åˆ™</th>
<th align="center">Behavior è¡Œä¸º</th>
</tr>
</thead>
<tbody><tr>
<td align="left">temp?</td>
<td align="center">æ’é™¤åœ¨æ ¹ç›®å½•ä¸­ temp ä¸€ä¸ªå­—ç¬¦æ‰©å±•åçš„æ–‡ä»¶å’Œç›®å½•ï¼Œæ¯”å¦‚ï¼štempaã€tempb</td>
</tr>
</tbody></table>
<p>åŒ¹é…ä½¿ç”¨çš„æ˜¯ Go çš„ <code>filepath.Match</code> è§„åˆ™ï¼Œé¢„å¤„ç†æ­¥éª¤åˆ é™¤ leading and trailing whitespace and eliminates <code>.</code> and <code>..</code> elements â€“ <code>filepath.Clean</code></p>
<p><code>**/*</code> ä¸æ˜¯ Go çš„åŒ¹é…è§„åˆ™ï¼Œè§„å®š æ’é™¤åŒ…æ‹¬æ ¹ç›®å½•åœ¨å†…çš„æ‰€æœ‰ç›®å½•ä¸‹çš„ .go æ–‡ä»¶</p>
<hr>
<p>ï¼ æ’é™¤ä¾‹å¤–</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*.md!README.md</span><br></pre></td></tr></table></figure>

<p>æ•ˆæœï¼šé™¤ ==README.md== ä»¥å¤–çš„æ‰€æœ‰æ–‡ä»¶éƒ½è¢«æ’é™¤åœ¨ä¸Šä¸‹æ–‡ä¹‹å¤–ã€‚</p>
<p>! çš„ä½ç½®å°†å½±å“è¿™ä¸ªè¡Œä¸º(behavior)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*.md<span class="comment"># åŒ¹é…è§„åˆ™ ä»¥ READMEå¼€å¤´ï¼Œ.mdç»“æœçš„æ–‡ä»¶ è¢«æ’é™¤!README*.mdREADME-secret.md</span></span><br></pre></td></tr></table></figure>

<p>æ•ˆæœï¼šé™¤äº† README*.md æ–‡ä»¶ï¼Œå…¶ä»–æ‰€æœ‰çš„ .mdæ–‡ä»¶ + README-secret.mdéƒ½å°†è¢«æ’é™¤ (exclude)</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*.md<span class="comment"># æ— æ•ˆREADME-secret.md# æ­¤å¤„åŒ¹é…è§„åˆ™ åŒ¹é…äº†ä¸Šé¢è¿™ä¸€è¡Œ!README*.md</span></span><br></pre></td></tr></table></figure>

<p>æ•ˆæœï¼šæ‰€æœ‰çš„ README*.md éƒ½å°†è¢«åŒ…å«åœ¨å†…ï¼Œå…¶ä»–çš„ .md æ–‡ä»¶è¢«æ’é™¤</p>
<p>ç”šè‡³å¯ä»¥ä½¿ç”¨ .dockerignore æ–‡ä»¶æ¥æ’é™¤ Dockerfile å’Œ .Dockerignore files è¿™äº›æ–‡ä»¶ä»ç„¶è¢«å‘é€åˆ°å®ˆæŠ¤è¿›ç¨‹ï¼Œå› ä¸ºå®ƒéœ€è¦è¿™äº›æ–‡ä»¶æ¥å®Œæˆå®ƒçš„å·¥ä½œã€‚ä½† ADD å’Œ COPY æŒ‡ä»¤ä¸ä¼šå°†å®ƒä»¬å¤åˆ¶åˆ°é•œåƒä¸­ã€‚</p>
<hr>
<h2 id="FROM-ğŸ”—"><a href="#FROM-ğŸ”—" class="headerlink" title="FROM ğŸ”—"></a>FROM <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/#from">ğŸ”—</a></h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> [--platform=&lt;platform&gt;] &lt;image&gt; [AS &lt;name&gt;]</span><br></pre></td></tr></table></figure>

<p>Or</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> [--platform=&lt;platform&gt;] &lt;image&gt;[:&lt;tag&gt;] [AS &lt;name&gt;]</span><br></pre></td></tr></table></figure>

<p>Or</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> [--platform=&lt;platform&gt;] &lt;image&gt;[@&lt;digest&gt;] [AS &lt;name&gt;]</span><br></pre></td></tr></table></figure>

<p>FROM æŒ‡ä»¤åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„æ„å»ºé˜¶æ®µï¼Œå¹¶ä¸ºåç»­æŒ‡ä»¤==è®¾ç½®åŸºæœ¬æ˜ åƒ==ã€‚å› æ­¤ï¼Œæœ‰æ•ˆçš„ Dockerfile å¿…é¡»ä»¥ FROM æŒ‡ä»¤å¼€å§‹ã€‚è¯¥é•œåƒå¯ä»¥æ˜¯ä»»ä½•æœ‰æ•ˆçš„é•œåƒâ€”â€”ä»å…¬å…±å­˜å‚¨åº“ä¸­æå–é•œåƒå°¤å…¶å®¹æ˜“ã€‚</p>
<ul>
<li><p>  <code>ARG</code> is the only instruction that may precede æ˜¯å”¯ä¸€çš„æŒ‡ç¤ºï¼Œå¯èƒ½å…ˆäº<code>FROM</code> in the åœ¨<code>Dockerfile</code>. <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/#understand-how-arg-and-from-interact">see Understand how ARG and FROM interact</a></p>
</li>
<li><p>  <code>FROM</code>å¯ä»¥åœ¨ä¸€ä¸ªDockerfileä¸­å¤šæ¬¡å‡ºç°ï¼Œä»¥åˆ›å»ºå¤šä¸ªæ˜ åƒæˆ–å°†ä¸€ä¸ªæ„å»ºé˜¶æ®µç”¨ä½œå¦ä¸€ä¸ªæ„å»ºé˜¶æ®µçš„ä¾èµ–é¡¹ã€‚ åœ¨æ¯ä¸ª <code>FORM</code> æŒ‡ä»¤ä¹‹å‰ï¼Œéœ€è¦è®°å½•(make a note of)é€šè¿‡ commit  æäº¤çš„æœ€åä¸€ä¸ªé•œåƒ ID è¾“å‡ºã€‚<code>FROM</code> æŒ‡ä»¤æ¸…é™¤ç”±å‰é¢çš„æŒ‡ä»¤åˆ›å»ºçš„ä»»ä½•çŠ¶æ€</p>
</li>
<li><p>  åœ¨ <code>FROM</code> æŒ‡ä»¤ å¢åŠ  <code>AS name</code> ï¼Œå‘½åæ–°çš„é•œåƒï¼Œè¿™ä¸ªåå­—å¯åœ¨ä¹‹åçš„(subsequent) FROM å’Œ <code>COPY --from=&lt;name&gt;</code> instructions ä¸­å¼•ç”¨</p>
</li>
<li><p>  <code>tag</code> and <code>digest</code> are optional. å¿½ç•¥ä¸¤è€…ï¼Œé»˜è®¤æŒ‡çš„æ˜¯æœ€æ–°çš„é•œåƒï¼Œè‹¥æ²¡æ‰¾åˆ°è¯¥é•œåƒè¿”å› error</p>
</li>
</ul>
<p>å¯é€‰çš„ <code>-- platform</code> æ ‡å¿—å¯ç”¨äºæŒ‡å®šå›¾åƒçš„å¹³å°ï¼Œä»¥é˜² <code>FROM</code> å¼•ç”¨å¤šå¹³å°å›¾åƒã€‚ä¾‹å¦‚ï¼Œlinux/amd64ã€ linux/arm64æˆ– windows/amd64ã€‚</p>
<h3 id="Understand-how-ARG-and-FROM-interact-äº¤äº’"><a href="#Understand-how-ARG-and-FROM-interact-äº¤äº’" class="headerlink" title="Understand how ARG and FROM interact(äº¤äº’)"></a>Understand how ARG and FROM interact(äº¤äº’)</h3><p>FROM æŒ‡ä»¤æ”¯æŒç”±==ç¬¬ä¸€ä¸ª FROM ä¹‹å‰çš„ä»»ä½• ARG æŒ‡ä»¤å£°æ˜çš„å˜é‡==ã€‚</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ARG</span>  CODE_VERSION=latestFROM base:$&#123;CODE_VERSION&#125;<span class="keyword">CMD</span><span class="bash">  /code/run-appFROM extras:<span class="variable">$&#123;CODE_VERSION&#125;</span>CMD  /code/run-extras</span></span><br></pre></td></tr></table></figure>



<h2 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a>RUN</h2><p>RUN æœ‰ä¸¤ç§å½¢å¼ï¼š</p>
<blockquote>
<ul>
<li>  <code>RUN &lt;command&gt;</code> (<em>shell</em> form, the command is run in a shell, which by default is <code>/bin/sh -c</code> on Linux or <code>cmd /S /C</code> on Windows)</li>
<li>  <code>RUN [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;]</code> (<em>exec</em> form)</li>
</ul>
</blockquote>
<p>RUN æŒ‡ä»¤å°†åœ¨å½“å‰æ˜ åƒé¡¶éƒ¨çš„æ–°å±‚ä¸­æ‰§è¡Œä»»ä½•å‘½ä»¤å¹¶æäº¤ç»“æœã€‚ç”Ÿæˆçš„æäº¤æ˜ åƒå°†ç”¨äº Dockerfile ä¸­çš„ä¸‹ä¸€æ­¥ã€‚</p>
<p>åˆ†å±‚(layering) <code>RUN</code> æŒ‡ä»¤å’Œç”Ÿæˆæäº¤ç¬¦åˆ(confirms to ) Docker çš„æ ¸å¿ƒæ¦‚å¿µ(core concept)ï¼Œå…¶ä¸­æäº¤å¾ˆæ–¹ä¾¿çš„ï¼Œå®¹å™¨èƒ½ä»é•œåƒå†å²çš„ä»»ä½•ä¸€ç‚¹åˆ›å»ºï¼Œå°±åƒæºä»£ç æ§åˆ¶</p>
<hr>
<p>The <em>exec</em> form å¯ä»¥é¿å…ç ´å shell å­—ç¬¦ä¸²ï¼Œå¹¶å¯ä»¥ä½¿ç”¨ä¸åŒ…å«æŒ‡å®š shell å¯æ‰§è¡Œæ–‡ä»¶çš„åŸºç¡€é•œåƒæ‰§è¡Œ <code>RUN</code> å‘½ä»¤ã€‚</p>
<p>In the <em>shell</em> form å¯ä»¥ä½¿ç”¨(åæ–œæ )å°†å•ä¸ª RUN æŒ‡ä»¤ç»§ç»­åˆ°ä¸‹ä¸€è¡Œã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘è¿™ä¸¤è¡Œ:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="bash"> /bin/bash -c <span class="string">&#x27;source $HOME/.bashrc; \echo $HOME&#x27;</span></span></span><br></pre></td></tr></table></figure>



<p>è¦ä½¿ç”¨ä¸åŒçš„ shell (é™¤äº†â€œ/bin/shâ€) ï¼Œå¯ä»¥ä½¿ç”¨ exec form ä¼ é€’æƒ³è¦çš„(desired) shellã€‚ä¾‹å¦‚:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="bash"> [<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;echo hello&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>  âš ï¸ï¼š</p>
<p>  Exec form è¢«è§£æä¸º(parsed as) JSON æ•°ç»„ï¼Œè¿™æ„å‘³ç€å¿…é¡»åœ¨å•å¼•å·(â€˜)å‰åä½¿ç”¨åŒå¼•å·(â€œ)ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¸ shell form ä¸åŒï¼Œ<span class="built_in">exec</span> form ä¸è°ƒç”¨å‘½ä»¤ shellã€‚è¿™æ„å‘³ç€ä¸ä¼šå‘ç”Ÿæ­£å¸¸çš„ shell å¤„ç†ã€‚ä¾‹å¦‚ï¼ŒRUN [â€œ <span class="built_in">echo</span>â€ï¼Œâ€œ <span class="variable">$HOME</span>â€] ä¸ä¼šå¯¹ <span class="variable">$HOME</span> è¿›è¡Œå˜é‡æ›¿æ¢ã€‚å¦‚æœæ‚¨æƒ³è¦ shell å¤„ç†ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ shell form æˆ–è€…ç›´æ¥æ‰§è¡Œ shellï¼Œä¾‹å¦‚: RUN [â€œ shâ€,â€-câ€ï¼Œâ€œ <span class="built_in">echo</span> <span class="variable">$HOME</span>â€]ã€‚å½“ä½¿ç”¨ <span class="built_in">exec</span> form å¹¶ç›´æ¥æ‰§è¡Œ shell æ—¶ï¼Œå°±åƒ shell form çš„ä¾‹å­ä¸€æ ·ï¼Œæ˜¯ shell åœ¨æ‰§è¡Œç¯å¢ƒå˜é‡æ‰©å±•ï¼Œè€Œä¸æ˜¯ dockerã€‚</span><br></pre></td></tr></table></figure>

<p>âš ï¸ï¼š</p>
<ul>
<li><p>åœ¨ JSON æ ¼å¼ä¸­ï¼Œæœ‰å¿…è¦å¯¹åæ–œæ è¿›è¡Œè½¬ä¹‰ã€‚è¿™åœ¨ Windows ä¸Šå°¤å…¶ç›¸å…³ï¼Œå› ä¸ºåæ–œæ æ˜¯è·¯å¾„åˆ†éš”ç¬¦ã€‚å¦åˆ™ï¼Œä¸‹é¢çš„è¡Œå°†è¢«è§†ä¸º shell è¡¨å•ï¼Œå› ä¸ºå®ƒä¸æ˜¯æœ‰æ•ˆçš„ JSONï¼Œå¹¶ä¸”ä»¥æ„å¤–çš„æ–¹å¼å¤±è´¥:</p>
  <figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="bash"> [<span class="string">&quot;c:\windows\system32\tasklist.exe&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>  The correct syntax for this example is:</p>
<p>  è¿™ä¸ªä¾‹å­çš„æ­£ç¡®è¯­æ³•æ˜¯:</p>
  <figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="bash"> [<span class="string">&quot;c:\\windows\\system32\\tasklist.exe&quot;</span>]</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>åœ¨ä¸‹ä¸€æ¬¡ç”ŸæˆæœŸé—´ï¼ŒRUN æŒ‡ä»¤çš„ç¼“å­˜ä¸ä¼šè‡ªåŠ¨å¤±æ•ˆã€‚åƒ RUN apt-get dist-upgrade-y è¿™æ ·çš„æŒ‡ä»¤çš„ç¼“å­˜å°†åœ¨ä¸‹ä¸€æ¬¡æ„å»ºæœŸé—´é‡ç”¨ã€‚å¯ä»¥ä½¿ç”¨ â€“ no-cache æ ‡å¿—ä½¿ RUN æŒ‡ä»¤çš„ç¼“å­˜å¤±æ•ˆï¼Œä¾‹å¦‚ docker build â€“ no-cacheã€‚</p>
<h2 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h2><p>CMD æŒ‡ä»¤æœ‰ä¸‰ç§å½¢å¼ï¼š</p>
<ul>
<li>  <code>CMD [&quot;executable&quot;,&quot;param1&quot;,&quot;param2&quot;]</code> (<em>exec</em> form, this is the preferred form)</li>
<li>  <code>CMD [&quot;param1&quot;,&quot;param2&quot;]</code> (as <em>default parameters to ENTRYPOINT</em>)</li>
<li>  <code>CMD command param1 param2</code> (<em>shell</em> form)</li>
</ul>
<p>==ä¸€ä¸ª Dockerfile ä¸­åªèƒ½æœ‰ä¸€æ¡ CMD æŒ‡ä»¤==ã€‚å¦‚æœæ‚¨åˆ—å‡ºäº†å¤šä¸ª CMDï¼Œé‚£ä¹ˆåªæœ‰æœ€åä¸€ä¸ª CMD æ‰ä¼šç”Ÿæ•ˆã€‚</p>
<p>CMD çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºæ­£åœ¨æ‰§è¡Œçš„å®¹å™¨æä¾›==ç¼ºçœå€¼==ã€‚è¿™äº›ç¼ºçœå€¼å¯ä»¥åŒ…æ‹¬ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥çœç•¥å¯æ‰§è¡Œæ–‡ä»¶ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿˜å¿…é¡»æŒ‡å®š ==ENTRYPOINT== æŒ‡ä»¤ã€‚</p>
<p>å¦‚æœä½¿ç”¨ CMD ä¸º ENTRYPOINT æŒ‡ä»¤æä¾›é»˜è®¤å‚æ•°ï¼Œåˆ™åº”ä½¿ç”¨ JSON æ•°ç»„æ ¼å¼æŒ‡å®š CMD å’Œ ENTRYPOINT æŒ‡ä»¤ã€‚</p>
<p>âš ï¸ï¼š</p>
<blockquote>
<p>  æ³¨æ„</p>
<p>  The <em>exec</em> form is parsed as a JSON array, which means that you must use double-quotes (â€œ) around words not single-quotes (â€˜).</p>
<p>  Exec è¡¨å•è¢«è§£æä¸º JSON æ•°ç»„ï¼Œè¿™æ„å‘³ç€å¿…é¡»åœ¨å•å¼•å·(â€˜)å‰åä½¿ç”¨åŒå¼•å·(â€œ)ã€‚</p>
</blockquote>
<p>åœ¨ shell æˆ– exec form ä¸­ä½¿ç”¨æ—¶ï¼Œ==CMD æŒ‡ä»¤è®¾ç½®è¿è¡Œæ˜ åƒæ—¶è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚==</p>
<hr>
<p>è‹¥ä½¿ç”¨ CMD çš„ shell å½¢å¼ï¼Œé‚£ä¹ˆ <command> å°†åœ¨ <code>/bin/sh -c</code> ä¸­æ‰§è¡Œ</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntuCMD echo <span class="string">&quot;This is a test.&quot;</span> | wc -</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ‚¨æƒ³åœ¨æ²¡æœ‰ shell çš„æƒ…å†µä¸‹è¿è¡Œ &lt; command &gt; ï¼Œé‚£ä¹ˆæ‚¨å¿…é¡»å°†å‘½ä»¤è¡¨ç¤ºä¸º JSON æ•°ç»„ï¼Œå¹¶å‘å¯æ‰§è¡Œæ–‡ä»¶æä¾›å®Œæ•´çš„è·¯å¾„ã€‚è¿™ç§æ•°ç»„å½¢å¼æ˜¯ CMD çš„é¦–é€‰æ ¼å¼ã€‚ä»»ä½•é¢å¤–çš„å‚æ•°éƒ½å¿…é¡»åœ¨æ•°ç»„ä¸­ä»¥å­—ç¬¦ä¸²çš„å½¢å¼å•ç‹¬è¡¨ç¤º:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntuCMD [<span class="string">&quot;/usr/bin/wc&quot;</span>,<span class="string">&quot;--help&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå¸Œæœ›å®¹å™¨æ¯æ¬¡éƒ½è¿è¡Œç›¸åŒçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œé‚£ä¹ˆåº”è¯¥è€ƒè™‘ç»“åˆä½¿ç”¨ ENTRYPOINT å’Œ CMDã€‚å‚è§ ENTRYPOINTã€‚</p>
<p>å¦‚æœç”¨æˆ·æŒ‡å®šå‚æ•°  <code>docker run</code>ï¼Œé‚£ä¹ˆå®ƒä»¬å°†è¦†ç›– CMD ä¸­æŒ‡å®šçš„ç¼ºçœå€¼ã€‚</p>
<p>âš ï¸ï¼š</p>
<p>ä¸è¦å°† RUN ä¸ CMD æ··æ·†ã€‚RUN å®é™…ä¸Šè¿è¡Œä¸€ä¸ªå‘½ä»¤å¹¶æäº¤ç»“æœ; </p>
<p>CMD åœ¨æ„å»ºæ—¶ä¸æ‰§è¡Œä»»ä½•å†…å®¹ï¼Œä½†æ˜¯ä¸ºæ˜ åƒæŒ‡å®šé¢„æœŸçš„å‘½ä»¤ã€‚</p>
<h2 id="LABEL"><a href="#LABEL" class="headerlink" title="LABEL"></a>LABEL</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="bash"> &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; ...</span></span><br></pre></td></tr></table></figure>

<p>LABEL æŒ‡ä»¤å‘æ˜ åƒæ·»åŠ å…ƒæ•°æ®ã€‚LABEL æ˜¯é”®å€¼å¯¹ã€‚è‹¥è¦åœ¨ LABEL å€¼ä¸­åŒ…å«ç©ºæ ¼ï¼Œè¯·åƒåœ¨å‘½ä»¤è¡Œè§£æä¸­é‚£æ ·ä½¿ç”¨å¼•å·å’Œåæ–œæ ã€‚ä¸€äº›ç”¨æ³•ä¾‹å­:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="bash"> <span class="string">&quot;com.example.vendor&quot;</span>=<span class="string">&quot;ACME Incorporated&quot;</span>LABEL com.example.label-with-value=<span class="string">&quot;foo&quot;</span>LABEL version=<span class="string">&quot;1.0&quot;</span>LABEL description=<span class="string">&quot;This text illustrates \that label-values can span multiple lines.&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªé•œåƒå¯ä»¥æœ‰å¤šä¸ªæ ‡ç­¾</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="bash"> multi.label1=<span class="string">&quot;value1&quot;</span> multi.label2=<span class="string">&quot;value2&quot;</span> other=<span class="string">&quot;value3&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>è‹¥è¦æŸ¥çœ‹å›¾åƒçš„æ ‡ç­¾ï¼Œè¯·ä½¿ç”¨ docker image inspect å‘½ä»¤ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ â€“ format é€‰é¡¹ä»…æ˜¾ç¤ºæ ‡ç­¾;</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image inspect --format=<span class="string">&#x27;&#x27;</span> myimage</span><br></pre></td></tr></table></figure>

<h2 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE"></a>EXPOSE</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXPOSE</span> &lt;port&gt; [&lt;port&gt;/&lt;protocol&gt;...]</span><br></pre></td></tr></table></figure>

<p>EXPOSE æŒ‡ä»¤é€šçŸ¥ Docker å®¹å™¨åœ¨è¿è¡Œæ—¶ç›‘å¬æŒ‡å®šçš„ç½‘ç»œç«¯å£ã€‚æ‚¨å¯ä»¥æŒ‡å®šç«¯å£æ˜¯å¦ä¾¦å¬ TCP æˆ– UDPï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šåè®®ï¼Œåˆ™é»˜è®¤ä¸º TCPã€‚</p>
<p>EXPOSE æŒ‡ä»¤å®é™…ä¸Šå¹¶ä¸å‘å¸ƒç«¯å£ã€‚å®ƒä½œä¸ºä¸€ç§æ–‡æ¡£ï¼Œä»‹äºæ„å»ºæ˜ åƒçš„äººå’Œè¿è¡Œå®¹å™¨çš„äººä¹‹é—´ï¼Œ==å…³äºæ‰“ç®—å‘å¸ƒå“ªäº›ç«¯å£ã€‚è¦åœ¨è¿è¡Œå®¹å™¨æ—¶å®é™…å‘å¸ƒç«¯å£ï¼Œå¯ä»¥ä½¿ç”¨ <code>docker run</code> ä¸Šçš„ <code>-p</code> æ ‡å¿—å‘å¸ƒå’Œæ˜ å°„ä¸€ä¸ªæˆ–å¤šä¸ªç«¯å£==ï¼Œæˆ–ä½¿ç”¨ <code>-p</code> æ ‡å¿—å‘å¸ƒæ‰€æœ‰å…¬å¼€çš„ç«¯å£å¹¶å°†å®ƒä»¬æ˜ å°„åˆ°é«˜é˜¶ç«¯å£ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒEXPOSE å‡è®¾ä¸º TCPã€‚æ‚¨ä¹Ÿå¯ä»¥æŒ‡å®š UDP:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span>/udp</span><br></pre></td></tr></table></figure>

<p>è¦åœ¨ TCP å’Œ UDP ä¸Šå…¬å¼€ï¼ŒåŒ…æ‹¬ä¸¤è¡Œï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span>/tcpEXPOSE <span class="number">80</span>/udp</span><br></pre></td></tr></table></figure>

<p>è®°ä½ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœå¯¹ docker è¿è¡Œä½¿ç”¨ -pï¼Œé‚£ä¹ˆç«¯å£å°†å¯¹ TCP å…¬å¼€ä¸€æ¬¡ï¼Œå¯¹ UDP å…¬å¼€ä¸€æ¬¡ã€‚è¯·è®°ä½ -p åœ¨ä¸»æœºä¸Šä½¿ç”¨ä¸´æ—¶çš„é«˜åºä¸»æœºç«¯å£ï¼Œå› æ­¤==å¯¹äº TCP å’Œ UDP ç«¯å£ä¸ä¼šç›¸åŒã€‚==</p>
<p>ä¸ç®¡ EXPOSE è®¾ç½®å¦‚ä½•ï¼Œæ‚¨éƒ½å¯ä»¥åœ¨è¿è¡Œæ—¶ä½¿ç”¨ -p æ ‡å¿—è¦†ç›–å®ƒä»¬</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="bash"> -p 80:80/tcp -p 80:80/udp ...</span></span><br></pre></td></tr></table></figure>

<p>è‹¥è¦==åœ¨ä¸»æœºç³»ç»Ÿä¸Šè®¾ç½®ç«¯å£é‡å®šå‘==ï¼Œè¯·å‚è§ä½¿ç”¨ -p æ ‡å¿—ã€‚Docker network å‘½ä»¤æ”¯æŒåœ¨å®¹å™¨ä¹‹é—´åˆ›å»ºé€šä¿¡ç½‘ç»œï¼Œè€Œä¸éœ€è¦å…¬å¼€æˆ–å‘å¸ƒç‰¹å®šçš„ç«¯å£ï¼Œå› ä¸ºè¿æ¥åˆ°ç½‘ç»œçš„å®¹å™¨å¯ä»¥é€šè¿‡ä»»ä½•ç«¯å£å½¼æ­¤é€šä¿¡ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æ­¤ç‰¹æ€§çš„æ¦‚è¿°ã€‚</p>
<p>==â€9000:80â€ # ç»‘å®šå®¹å™¨çš„80ç«¯å£åˆ°ä¸»æœºçš„9000==</p>
<h2 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> &lt;key&gt;=&lt;value&gt; ...</span><br></pre></td></tr></table></figure>

<p>ä¾‹å­ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> MY_NAME=<span class="string">&quot;John Doe&quot;</span><span class="keyword">ENV</span> MY_DOG=Rex\ The\ DogENV MY_CAT=fluffy</span><br></pre></td></tr></table></figure>

<p>or</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> MY_NAME=<span class="string">&quot;John Doe&quot;</span> MY_DOG=Rex\ The\ Dog \    MY_CAT=fluffy</span><br></pre></td></tr></table></figure>

<p>å½“ä»ç»“æœæ˜ åƒè¿è¡Œå®¹å™¨æ—¶ï¼Œä½¿ç”¨ ==ENV è®¾ç½®çš„ç¯å¢ƒå˜é‡å°†æŒä¹…å­˜åœ¨==ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ <code>docker inspect</code> æŸ¥çœ‹è¿™äº›å€¼ï¼Œå¹¶ä½¿ç”¨ <code>docker run -- env &lt; key &gt; = &lt; value &gt;</code> æ›´æ”¹å®ƒä»¬ã€‚</p>
<p>ç¯å¢ƒå˜é‡çš„æŒç»­æ€§ä¼šå¯¼è‡´æ„æƒ³ä¸åˆ°çš„å‰¯ä½œç”¨(side effects)ã€‚</p>
<p>For example, setting <code>ENV DEBIAN_FRONTEND=noninteractive</code> changes the behavior of <code>apt-get</code>(æ”¹å˜ apt-get çš„è¡Œä¸º), and may confuse users of your image.</p>
<hr>
<p>å¦‚æœåœ¨==æ„å»ºè¿‡ç¨‹==ä¸­åªéœ€è¦ä¸€ä¸ªç¯å¢ƒå˜é‡å‘½ä»¤ï¼Œåœ¨æœ€åçš„é•œåƒä¸­ä¸éœ€è¦çš„è¯ï¼Œå¯ä»¥è€ƒè™‘ä¸ºå•ä¸ªå‘½ä»¤è®¾ç½®ä¸€ä¸ªå€¼</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get install -y ...</span></span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ä½¿ç”¨ <code>ARG</code>ï¼Œå®ƒä¸ä¼šæŒä¹…åŒ–åœ¨æœ€ç»ˆçš„å›¾ç‰‡ä¸­ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ARG</span> DEBIAN_FRONTEND=noninteractiveRUN apt-get update &amp;&amp; apt-get install -y ...</span><br></pre></td></tr></table></figure>

<p>ğŸ’¡ï¼š</p>
<p>ä¸Šè¿°ä¸¤ç§å†™æ³•ï¼š</p>
<p>DEBIAN_FRONTEND å˜é‡éƒ½ä¸ä¼šåœ¨é•œåƒ(images)ä¸­å‡ºç°</p>
<h3 id="æ›¿ä»£è¯­æ³•ï¼š"><a href="#æ›¿ä»£è¯­æ³•ï¼š" class="headerlink" title="æ›¿ä»£è¯­æ³•ï¼š"></a>æ›¿ä»£è¯­æ³•ï¼š</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯ä»¥çœç•¥ =ï¼Œå¦‚ï¼šENV MY_VAR my-value# æ­¤è¯­æ³•ä¸å…è®¸åœ¨å•ä¸ª ENV æŒ‡ä»¤ä¸­è®¾ç½®å¤šä¸ªç¯å¢ƒå˜é‡ï¼Œä¾‹å¦‚ï¼Œä¸‹é¢è®¾ç½®ä¸€ä¸ªå€¼ä¸ºâ€œ TWO = THREE = worldâ€çš„å•ä¸ªç¯å¢ƒå˜é‡(ONE) :ENV ONE TWO= THREE=world# æœ‰æ­§ä¹‰</span></span><br></pre></td></tr></table></figure>

<p>è¿™ç§æ›¿ä»£è¯­æ³•åœ¨å‘ä¸‹å…¼å®¹ä¸­å¾—åˆ°äº†æ”¯æŒï¼Œä½†æ˜¯ç”±äºä¸Šè¿°åŸå› ä¸é¼“åŠ±ä½¿ç”¨ï¼Œå¹¶ä¸”å¯èƒ½ä¼šåœ¨ä»¥åçš„ç‰ˆæœ¬ä¸­è¢«åˆ é™¤ã€‚</p>
<hr>
<h2 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a>ADD</h2><p>ADD æœ‰ä¸¤ç§å½¢å¼:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="bash"> [--chown=&lt;user&gt;:&lt;group&gt;] &lt;src&gt;... &lt;dest&gt;ADD [--chown=&lt;user&gt;:&lt;group&gt;] [<span class="string">&quot;&lt;src&gt;&quot;</span>,... <span class="string">&quot;&lt;dest&gt;&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>åä¸€ç§å½¢å¼æ˜¯æœåŠ¡äºåŒ…å«ç©ºç™½çš„è·¯å¾„ã€‚</p>
<p>âš ï¸ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿™ä¸ª --chown ç‰¹æ€§åªæ”¯æŒæ„å»º Linux å®¹å™¨çš„ Dockerfilesï¼Œä¸æ”¯æŒ Windows å®¹å™¨ã€‚ç”±äºç”¨æˆ·å’Œç»„çš„æ‰€æœ‰æƒæ¦‚å¿µä¸èƒ½åœ¨ Linux å’Œ Windows ä¹‹é—´è½¬æ¢ï¼Œå› æ­¤ä½¿ç”¨/etc/passwd å’Œ/etc/group å°†ç”¨æˆ·å’Œç»„åç§°è½¬æ¢ä¸º id é™åˆ¶äº†è¿™ä¸€ç‰¹æ€§åªé€‚ç”¨äºåŸºäº Linux çš„å®¹å™¨ã€‚</span><br></pre></td></tr></table></figure>

<p>Add å‘½ä»¤ä» <src> è·¯å¾„å¤åˆ¶ æ–°çš„æ–‡ä»¶ã€ç›®å½•æˆ–è€…è¿œç¨‹æ–‡ä»¶ urlï¼Œå¹¶å°†ä»–ä»¬æ·»åŠ åˆ°ä½äº <dest> è·¯å¾„çš„é•œåƒæ–‡ä»¶ç³»ç»Ÿ</p>
<p>å¯ä»¥æŒ‡å®šå¤šä¸ª &lt; src &gt; èµ„æºï¼Œä½†æ˜¯å¦‚æœå®ƒä»¬æ˜¯æ–‡ä»¶æˆ–ç›®å½•ï¼Œé‚£ä¹ˆå®ƒä»¬çš„è·¯å¾„å°†è¢«è§£é‡Šä¸ºç›¸å¯¹äºæ„å»ºä¸Šä¸‹æ–‡çš„æºã€‚</p>
<hr>
<p>æ·»åŠ  hom å¼€å¤´çš„æ‰€æœ‰æ–‡ä»¶</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="bash"> hom* /mydir/</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œå°†? æ›¿æ¢ä¸ºä»»ä½•å•ä¸ªå­—ç¬¦ï¼Œä¾‹å¦‚â€œ home.txtâ€ã€‚</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="bash"> hom?.txt /mydir/</span></span><br></pre></td></tr></table></figure>

<p>&lt; dest &gt; æ˜¯ä¸€ä¸ª==ç»å¯¹è·¯å¾„==ï¼Œæˆ–è€…ç›¸å¯¹äº WORKDIR çš„è·¯å¾„ï¼Œæºæ–‡ä»¶å°†è¢«å¤åˆ¶åˆ°==ç›®æ ‡å®¹å™¨==ä¸­ã€‚</p>
<p>ä¸‹é¢çš„ä¾‹å­ä½¿ç”¨äº†ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼Œå¹¶å°†â€œ test.txtâ€æ·»åŠ åˆ° &lt; workdir &gt;/relativeDir/:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="bash"> test.txt relativeDir/</span></span><br></pre></td></tr></table></figure>

<p>å½“æ·»åŠ åŒ…å«ç‰¹æ®Šå­—ç¬¦(å¦‚[å’Œ])çš„æ–‡ä»¶æˆ–ç›®å½•æ—¶ï¼Œæ‚¨éœ€è¦è½¬ä¹‰éµå¾ª Golang è§„åˆ™çš„é‚£äº›è·¯å¾„ï¼Œä»¥é˜²æ­¢å®ƒä»¬è¢«è§†ä¸ºåŒ¹é…çš„æ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œæ·»åŠ åä¸º arr [0] .txt  æ–‡ä»¶ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤;</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="bash"> arr[[]0].txt /mydir/</span></span><br></pre></td></tr></table></figure>

<p>æ‰€æœ‰æ–°çš„æ–‡ä»¶å’Œç›®å½•éƒ½ä½¿ç”¨ UID å’Œ GID ä¸º0åˆ›å»ºï¼Œé™¤éå¯é€‰çš„ <code>-- chown</code> æ ‡å¿—æŒ‡å®šç»™å®šçš„ç”¨æˆ·åã€ç»„åæˆ– UID/GID ç»„åˆ æ¥è¯·æ±‚æ‰€æ·»åŠ å†…å®¹çš„ç‰¹å®šæ‰€æœ‰æƒã€‚<code>-- chown</code> æ ‡å¿—çš„æ ¼å¼å…è®¸åœ¨ä»»ä½•ç»„åˆä¸­ä½¿ç”¨ç”¨æˆ·åå’Œç»„åå­—ç¬¦ä¸²æˆ–ç›´æ¥æ•´æ•° UID å’Œ GIDã€‚æä¾›ä¸å¸¦ç»„åæˆ–ä¸å¸¦ GID çš„ UID çš„ç”¨æˆ·åå°†ä½¿ç”¨ä¸ GID ç›¸åŒçš„æ•°å­— UIDã€‚å¦‚æœæä¾›äº†ç”¨æˆ·åæˆ–ç»„åï¼Œåˆ™å°†åˆ†åˆ«ä½¿ç”¨å®¹å™¨çš„æ ¹æ–‡ä»¶ç³»ç»Ÿ/etc/passwd å’Œ/etc/group æ–‡ä»¶æ‰§è¡Œä»åç§°åˆ°æ•´æ•° UID æˆ– GID çš„è½¬æ¢ã€‚ä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºäº† â€“ chown æ ‡å¿—çš„æœ‰æ•ˆå®šä¹‰:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="bash"> --chown=55:mygroup files* /somedir/ADD --chown=bin files* /somedir/ADD --chown=1 files* /somedir/ADD --chown=10:11 files* /somedir/</span></span><br></pre></td></tr></table></figure>

<p>âš ï¸ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¦‚æœæ‚¨é€šè¿‡ STDIN (docker build - &lt; somefile)ä¼ é€’ Dockerfile æ¥æ„å»ºï¼Œé‚£ä¹ˆå°±æ²¡æœ‰æ„å»ºä¸Šä¸‹æ–‡ï¼Œå› æ­¤ Dockerfile åªèƒ½åŒ…å«åŸºäº URL çš„ ADD æŒ‡ä»¤ã€‚æ‚¨è¿˜å¯ä»¥é€šè¿‡ STDIN ä¼ é€’å‹ç¼©çš„å½’æ¡£æ–‡ä»¶: (docker build - &lt; archive.tar.gz) ï¼Œå½’æ¡£æ–‡ä»¶çš„æ ¹ç›®å½•ä¸‹çš„ Dockerfile å’Œå½’æ¡£æ–‡ä»¶çš„å…¶ä½™éƒ¨åˆ†å°†ç”¨ä½œæ„å»ºçš„ä¸Šä¸‹æ–‡ã€‚</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ‚¨çš„ URL æ–‡ä»¶ä½¿ç”¨èº«ä»½éªŒè¯æ¥ä¿æŠ¤ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦ä½¿ç”¨ RUN wgetã€ RUN curl æˆ–è€…ä½¿ç”¨å®¹å™¨å†…çš„å…¶ä»–å·¥å…·ï¼Œå› ä¸º ==ADD æŒ‡ä»¤ä¸æ”¯æŒèº«ä»½éªŒè¯ã€‚==</p>
<h3 id="ADD-éµå®ˆä»¥ä¸‹è§„åˆ™"><a href="#ADD-éµå®ˆä»¥ä¸‹è§„åˆ™" class="headerlink" title="ADD éµå®ˆä»¥ä¸‹è§„åˆ™:"></a>ADD éµå®ˆä»¥ä¸‹è§„åˆ™:</h3><ul>
<li>è·¯å¾„å¿…é¡»ä½äºæ„å»ºçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œä¸èƒ½ <code>ADD ../something /something</code> å› ä¸º docker æ„å»ºçš„ç¬¬ä¸€æ­¥æ˜¯å°†ä¸Šä¸‹æ–‡ç›®å½•(å’Œå­ç›®å½•)å‘é€ç»™ docker daemonã€‚<ul>
<li>  æ‰€ä»¥ docker daemon åªæ‹¥æœ‰ context å’Œ subdirectories ï¼Œæ²¡æœ‰ ä¸Šä¸‹æ–‡ç›®å½•ä¸Šä¸€çº§çš„å†…å®¹</li>
</ul>
</li>
<li>  å¦‚æœ &lt; src &gt; æ˜¯ä¸€ä¸ª URLï¼Œè€Œ &lt; dest &gt; æ²¡æœ‰ä»¥æ–œæ ç»“å°¾ï¼Œé‚£ä¹ˆæ–‡ä»¶å°†ä» URL ä¸‹è½½å¹¶å¤åˆ¶åˆ° &lt; dest &gt; ã€‚ </li>
<li>  å¦‚æœ &lt; src &gt; æ˜¯ä¸€ä¸ª URLï¼Œè€Œ &lt; dest &gt; ç¡®å®ä»¥ä¸€ä¸ªå°¾éƒ¨æ–œæ ç»“å°¾ï¼Œé‚£ä¹ˆæ–‡ä»¶åå°±ä¼šä» URL ä¸­æ¨æ–­å‡ºæ¥ï¼Œæ–‡ä»¶å°±ä¼šè¢«ä¸‹è½½åˆ° &lt; dest &gt;/&lt; filename &gt; ä¸­ã€‚ä¾‹å¦‚ï¼ŒADD <a target="_blank" rel="noopener" href="http://example.com/foobar">http://example.com/foobar</a> /å°†åˆ›å»ºæ–‡ä»¶/foobarã€‚URL å¿…é¡»æœ‰ä¸€ä¸ªé‡è¦çš„è·¯å¾„ï¼Œä»¥ä¾¿åœ¨è¿™ç§æƒ…å†µä¸‹å¯ä»¥å‘ç°ä¸€ä¸ªåˆé€‚çš„æ–‡ä»¶å( <a target="_blank" rel="noopener" href="http://example.com/">http://example.com</a> æ–‡ä»¶ä¸èµ·ä½œç”¨)ã€‚</li>
<li>  å¦‚æœ &lt; src &gt; æ˜¯ä¸€ä¸ªç›®å½•ï¼Œåˆ™å¤åˆ¶è¯¥ç›®å½•çš„å…¨éƒ¨å†…å®¹ï¼ŒåŒ…æ‹¬==æ–‡ä»¶ç³»ç»Ÿå…ƒæ•°æ®==ã€‚</li>
</ul>
<p>âš ï¸ï¼š</p>
<p>==ä¸å¤åˆ¶ç›®å½•æœ¬èº«ï¼Œåªå¤åˆ¶å…¶å†…å®¹ã€‚==</p>
<h2 id="COPY"><a href="#COPY" class="headerlink" title="COPY"></a>COPY</h2><p>ADD å‘½ä»¤æ˜¯ COPY å‘½ä»¤çš„è¶…é›†</p>
<p>==æ³¨æ„äº‹é¡¹ï¼š==</p>
<p>ADD æ˜¯æ‹·è´åŠ  è§£å‹ç¼© + è§£æ</p>
<p>COPY æ˜¯åªæœ‰æ‹·è´</p>
<h2 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h2><p><strong>ä¸ CMD æ•ˆæœå·®ä¸å¤š</strong></p>
<p>åŒºåˆ«ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1. CMD - docker run çš„å‚æ•°ä¼šè¦†ç›– CMD æŒ‡å®šçš„2. ENTRYPOINT - docker run çš„å‚æ•°ä¼šè¿½åŠ åˆ° ENTRYPOINT æŒ‡å®šçš„å‚æ•°</span><br></pre></td></tr></table></figure>



<p>ENTRYPOING æœ‰ä¸¤ç§å½¢å¼ï¼š</p>
<p>The <em>exec</em> form, which is the preferred form(é¦–é€‰çš„å½¢å¼):</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">&quot;executable&quot;</span>, <span class="string">&quot;param1&quot;</span>, <span class="string">&quot;param2&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>The <em>shell</em> form:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> <span class="built_in">command</span> param1 param2</span></span><br></pre></td></tr></table></figure>

<p>ENTRYPOINT å…è®¸æ‚¨é…ç½® ä½œä¸º==å¯æ‰§è¡Œæ–‡ä»¶è¿è¡Œçš„å®¹å™¨==</p>
<p>ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç ä»¥ nginx çš„é»˜è®¤å†…å®¹å¼€å§‹ï¼Œç›‘å¬ç«¯å£80:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -i -t --rm -p 80:80 nginx</span><br></pre></td></tr></table></figure>

<p><code>docker run &lt;image&gt;</code> çš„å‘½ä»¤è¡Œå‚æ•°å°†ä¼šæ·»åŠ åˆ° <em>exec</em> form <code>ENTRYPOINT</code>çš„æ‰€æœ‰å…ƒç´ ä¹‹åï¼Œå¹¶å°†è¦†ç›–ä½¿ç”¨ CMD æŒ‡å®šçš„æ‰€æœ‰å…ƒç´ ã€‚è¿™å…è®¸å°†å‚æ•°ä¼ é€’åˆ°å…¥å£ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œdocker run &lt; image &gt;-d ä¼šå°† -d å‚æ•°ä¼ é€’åˆ°å…¥å£ç‚¹ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ docker run â€“ ENTRYPOINT æ ‡å¿—è¦†ç›– ENTRYPOINT æŒ‡ä»¤ã€‚</p>
<p>Shell form é˜²æ­¢ä½¿ç”¨ä»»ä½• CMD æˆ–è¿è¡Œå‘½ä»¤è¡Œå‚æ•°ï¼Œä½†ç¼ºç‚¹æ˜¯ ENTRYPOINT  å°†ä½œä¸º <code>/bin/sh-c</code> çš„å­å‘½ä»¤å¯åŠ¨ï¼Œå®ƒä¸ä¼ é€’ä¿¡å·ã€‚è¿™æ„å‘³ç€å¯æ‰§è¡Œæ–‡ä»¶ä¸ä¼šæ˜¯å®¹å™¨çš„ <code>PID 1</code>-ä¹Ÿä¸ä¼šæ¥æ”¶ Unix ä¿¡å·-æ‰€ä»¥ä½ çš„å¯æ‰§è¡Œæ–‡ä»¶ä¸ä¼šæ¥æ”¶æ¥è‡ª docker stop &lt; container &gt; çš„ SIGTERMã€‚</p>
<p>åªæœ‰ Dockerfile ä¸­çš„æœ€åä¸€æ¡ ENTRYPOINT æŒ‡ä»¤æ‰ä¼šç”Ÿæ•ˆã€‚</p>
<p><strong>è¡¥å……ï¼š</strong></p>
<p>dockerfileä¸ºï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centosCMD [<span class="string">&quot;p in cmd&quot;</span>]<span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">&quot;echo&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœrunä¸å¸¦å‚æ•°ï¼š</p>
<img src="https://cdn.jsdelivr.net/gh/PictureBed/blog0-img/Dockerfile ç¼–å†™æ„å»ºé•œåƒ.assets/Center.png" alt="img" style="zoom:50%;" />


<p>å¦‚æœrunå¸¦å‚æ•°ï¼š</p>
<img src="https://cdn.jsdelivr.net/gh/PictureBed/blog0-img/Dockerfile ç¼–å†™æ„å»ºé•œåƒ.assets/Center-20210517093251884.png" alt="img" style="zoom:50%;" />

<p>è€Œä¸”ï¼Œç¡®å®entrypointçš„ä¸­æ‹¬å·å½¢å¼ä¸‹ï¼Œcommandæ˜¯åœ¨shellç¯å¢ƒä¸‹è¿è¡Œçš„ï¼Œå¦åˆ™è¿™é‡Œçš„echoæ˜¯æ— æ³•è¢«æ‰§è¡Œçš„ã€‚</p>
<p>ç¬¬äºŒç§æ˜¯shellæ¨¡å¼çš„ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œä»»ä½•runå’Œcmdçš„å‚æ•°éƒ½æ— æ³•è¢«ä¼ å…¥åˆ°entrypointé‡Œã€‚å®˜ç½‘æ¨èç¬¬ä¸€ç§ç”¨æ³•ã€‚</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centosCMD [<span class="string">&quot;p in cmd&quot;</span>]<span class="keyword">ENTRYPOINT</span><span class="bash"> <span class="built_in">echo</span></span></span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/PictureBed/blog0-img/Dockerfile ç¼–å†™æ„å»ºé•œåƒ.assets/Center-20210517093300184.png" alt="img" style="zoom:50%;" />


<p>cmdçš„å‚æ•°æ²¡æœ‰è¢«æ‰“å°ã€‚</p>
<h2 id="VOLUME"><a href="#VOLUME" class="headerlink" title="VOLUME"></a>VOLUME</h2><p>ğŸ’¡ï¼šDockerfile æ–¹å¼åˆ›å»º VOLUME ï¼Œå¯¹åº”çš„å®¿ä¸»æœºç›®å½•æ˜¯è‡ªåŠ¨åˆ›å»º</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect containerID</span><br></pre></td></tr></table></figure>

<p>â€‹    â€“ æ³¨æ„ï¼šMounts å±æ€§ï¼Œå¯ä»¥æ‰¾åˆ°</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">&quot;/data&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>VOLUME æŒ‡ä»¤åˆ›å»ºå…·æœ‰æŒ‡å®šåç§°çš„æŒ‚è½½ç‚¹ï¼Œå¹¶å°†å…¶æ ‡è®°ä¸ºä¿å­˜æ¥è‡ªæœ¬æœºä¸»æœºæˆ–å…¶ä»–å®¹å™¨çš„å¤–éƒ¨æŒ‚è½½çš„å·ã€‚è¿™ä¸ªå€¼å¯ä»¥æ˜¯ JSON æ•°ç»„ã€ <code>VOLUME  [â€/var/log/â€]</code> ï¼Œæˆ–å…·æœ‰å¤šä¸ªå‚æ•°çš„æ™®é€šå­—ç¬¦ä¸²ï¼Œå¦‚ <code>VOLUME /var/log</code> æˆ– <code>VOLUME /var/log/var/var/db</code>ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯/ç¤ºä¾‹å’Œé€šè¿‡ Docker å®¢æˆ·ç«¯å®‰è£…è¯´æ˜ï¼Œè¯·å‚é˜…é€šè¿‡å·æ–‡æ¡£å…±äº«ç›®å½•ã€‚</p>
<p><code>docker run</code> å‘½ä»¤ä½¿ç”¨ åœ¨åŸºæœ¬é•œåƒä¸­æŒ‡å®šçš„ä½ç½®çš„æ‰€æœ‰æ•°æ®åˆå§‹åŒ–è¿™æ–°åˆ›å»ºçš„å·ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸‹é¢çš„ dockerfile ç‰‡æ®µï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mkdir /myvol</span></span><br><span class="line"><span class="comment"># è¦†ç›–å†™</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&quot;hello world&quot;</span> &gt; /myvol/greeting</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> /myvol</span></span><br></pre></td></tr></table></figure>



<h1 id="EXAMPLE"><a href="#EXAMPLE" class="headerlink" title="EXAMPLE"></a>EXAMPLE</h1><h2 id="multi-stage-build"><a href="#multi-stage-build" class="headerlink" title="multi-stage build"></a>multi-stage build</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># syntax=docker/dockerfile:1</span></span><br><span class="line"><span class="keyword">FROM</span> golang:<span class="number">1.16</span>-alpine AS build</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install tools required for project</span></span><br><span class="line"><span class="comment"># Run `docker build --no-cache .` to update dependencies</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apk add --no-cache git</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> go get github.com/golang/dep/cmd/dep</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># List project dependencies with Gopkg.toml and Gopkg.lock</span></span><br><span class="line"><span class="comment"># These layers are only re-built when Gopkg files are updated</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> Gopkg.lock Gopkg.toml /go/src/project/</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /go/src/project/</span></span><br><span class="line"><span class="comment"># Install library dependencies</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> dep ensure -vendor-only</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Copy the entire project and build it</span></span><br><span class="line"><span class="comment"># This layer is rebuilt when a file changes in the project directory</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . /go/src/project/</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> go build -o /bin/project</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This results in a single layer image</span></span><br><span class="line"><span class="keyword">FROM</span> scratch</span><br><span class="line"><span class="comment">#### !!!! è°ƒç”¨æ–¹å¼ å¤šé˜¶æ®µ</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> --from=build /bin/project /bin/project</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">&quot;/bin/project&quot;</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;--help&quot;</span>]</span></span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:2018212212275@stu.hznu.edu.cn">Nebulaoc</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://nebulaoc.cn/2021/07/09/docker-%E7%BC%96%E5%86%99%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F%E5%85%B3%E9%94%AE%E5%AD%97/">https://nebulaoc.cn/2021/07/09/docker-ç¼–å†™æ„å»ºé•œåƒå…³é”®å­—/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://nebulaoc.cn" target="_blank">çŸ¥è¯†çš„æ¬è¿å·¥</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> æ‰“èµ</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/personalData/img/wechatpay.png" target="_blank"><img class="post-qr-code-img" src="/personalData/img/wechatpay.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/personalData/img/alipay.png" target="_blank"><img class="post-qr-code-img" src="/personalData/img/alipay.png" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2021/04/19/MySQL%E6%97%A5%E5%BF%97-%E5%88%9D%E6%AD%A5%E5%AD%A6%E4%B9%A0/"><img class="next-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">MySQLæ—¥å¿—,åˆæ­¥å­¦ä¹ </div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/personalData/img/profile/head.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Nebulaoc</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">8</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">14</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">4</div></a></div></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Nebulaoc" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:2018212212275@stu.hznu.edu.cn" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>å…¬å‘Š</span></div><div class="announcement_content">æ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢ï¼Œæˆ‘å°†ä¼šåœ¨è¿™é‡Œåˆ†äº«è‡ªå·±å¯¹äºè®¡ç®—æœºçŸ¥è¯†çš„è§è§£ï½</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Dockerfile-reference"><span class="toc-number">1.</span> <span class="toc-text">Dockerfile reference</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Usage-%E7%94%A8%E6%B3%95"><span class="toc-number">1.1.</span> <span class="toc-text">Usage ç”¨æ³•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BuildKit"><span class="toc-number">1.2.</span> <span class="toc-text">BuildKit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Format-%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.3.</span> <span class="toc-text">Format æ ¼å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Parser-directives-%E8%A7%A3%E6%9E%90%E5%99%A8%E6%8C%87%E4%BB%A4"><span class="toc-number">1.4.</span> <span class="toc-text">Parser directives è§£æå™¨æŒ‡ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#syntax-%E8%AF%AD%E6%B3%95"><span class="toc-number">1.4.1.</span> <span class="toc-text">syntax è¯­æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Environment-replacement"><span class="toc-number">1.4.2.</span> <span class="toc-text">Environment replacement</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dockerignore-file-%F0%9F%94%97"><span class="toc-number">1.5.</span> <span class="toc-text">.dockerignore file ğŸ”—</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FROM-%F0%9F%94%97"><span class="toc-number">1.6.</span> <span class="toc-text">FROM ğŸ”—</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Understand-how-ARG-and-FROM-interact-%E4%BA%A4%E4%BA%92"><span class="toc-number">1.6.1.</span> <span class="toc-text">Understand how ARG and FROM interact(äº¤äº’)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RUN"><span class="toc-number">1.7.</span> <span class="toc-text">RUN</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CMD"><span class="toc-number">1.8.</span> <span class="toc-text">CMD</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LABEL"><span class="toc-number">1.9.</span> <span class="toc-text">LABEL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EXPOSE"><span class="toc-number">1.10.</span> <span class="toc-text">EXPOSE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ENV"><span class="toc-number">1.11.</span> <span class="toc-text">ENV</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%BF%E4%BB%A3%E8%AF%AD%E6%B3%95%EF%BC%9A"><span class="toc-number">1.11.1.</span> <span class="toc-text">æ›¿ä»£è¯­æ³•ï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ADD"><span class="toc-number">1.12.</span> <span class="toc-text">ADD</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ADD-%E9%81%B5%E5%AE%88%E4%BB%A5%E4%B8%8B%E8%A7%84%E5%88%99"><span class="toc-number">1.12.1.</span> <span class="toc-text">ADD éµå®ˆä»¥ä¸‹è§„åˆ™:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#COPY"><span class="toc-number">1.13.</span> <span class="toc-text">COPY</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ENTRYPOINT"><span class="toc-number">1.14.</span> <span class="toc-text">ENTRYPOINT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VOLUME"><span class="toc-number">1.15.</span> <span class="toc-text">VOLUME</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#EXAMPLE"><span class="toc-number">2.</span> <span class="toc-text">EXAMPLE</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#multi-stage-build"><span class="toc-number">2.1.</span> <span class="toc-text">multi-stage build</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/07/09/docker-%E7%BC%96%E5%86%99%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F%E5%85%B3%E9%94%AE%E5%AD%97/" title="docker ç¼–å†™æ„å»ºé•œåƒå…³é”®å­—"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="docker ç¼–å†™æ„å»ºé•œåƒå…³é”®å­—"/></a><div class="content"><a class="title" href="/2021/07/09/docker-%E7%BC%96%E5%86%99%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F%E5%85%B3%E9%94%AE%E5%AD%97/" title="docker ç¼–å†™æ„å»ºé•œåƒå…³é”®å­—">docker ç¼–å†™æ„å»ºé•œåƒå…³é”®å­—</a><time datetime="2021-07-09T02:06:27.000Z" title="å‘è¡¨äº 2021-07-09 10:06:27">2021-07-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/04/19/MySQL%E6%97%A5%E5%BF%97-%E5%88%9D%E6%AD%A5%E5%AD%A6%E4%B9%A0/" title="MySQLæ—¥å¿—,åˆæ­¥å­¦ä¹ "><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQLæ—¥å¿—,åˆæ­¥å­¦ä¹ "/></a><div class="content"><a class="title" href="/2021/04/19/MySQL%E6%97%A5%E5%BF%97-%E5%88%9D%E6%AD%A5%E5%AD%A6%E4%B9%A0/" title="MySQLæ—¥å¿—,åˆæ­¥å­¦ä¹ ">MySQLæ—¥å¿—,åˆæ­¥å­¦ä¹ </a><time datetime="2021-04-19T07:38:45.000Z" title="å‘è¡¨äº 2021-04-19 15:38:45">2021-04-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/04/15/Maven%E5%85%A5%E9%97%A8/" title="Mavenå…¥é—¨"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Mavenå…¥é—¨"/></a><div class="content"><a class="title" href="/2021/04/15/Maven%E5%85%A5%E9%97%A8/" title="Mavenå…¥é—¨">Mavenå…¥é—¨</a><time datetime="2021-04-14T23:58:06.000Z" title="å‘è¡¨äº 2021-04-15 07:58:06">2021-04-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/04/13/Https-%E9%93%BE%E6%8E%A5%E8%BF%87%E7%A8%8B%E7%B2%97%E8%A7%A3/" title="Https é“¾æ¥è¿‡ç¨‹ç²—è§£"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Https é“¾æ¥è¿‡ç¨‹ç²—è§£"/></a><div class="content"><a class="title" href="/2021/04/13/Https-%E9%93%BE%E6%8E%A5%E8%BF%87%E7%A8%8B%E7%B2%97%E8%A7%A3/" title="Https é“¾æ¥è¿‡ç¨‹ç²—è§£">Https é“¾æ¥è¿‡ç¨‹ç²—è§£</a><time datetime="2021-04-13T08:10:19.000Z" title="å‘è¡¨äº 2021-04-13 16:10:19">2021-04-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/04/13/Nginx-%E9%80%9A%E8%BF%87Certbot%E4%B8%BA%E7%BD%91%E7%AB%99%E9%85%8D%E7%BD%AEhttps%E9%93%BE%E6%8E%A5/" title="Nginx,é€šè¿‡Certbotä¸ºç½‘ç«™é…ç½®httpsé“¾æ¥"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nginx,é€šè¿‡Certbotä¸ºç½‘ç«™é…ç½®httpsé“¾æ¥"/></a><div class="content"><a class="title" href="/2021/04/13/Nginx-%E9%80%9A%E8%BF%87Certbot%E4%B8%BA%E7%BD%91%E7%AB%99%E9%85%8D%E7%BD%AEhttps%E9%93%BE%E6%8E%A5/" title="Nginx,é€šè¿‡Certbotä¸ºç½‘ç«™é…ç½®httpsé“¾æ¥">Nginx,é€šè¿‡Certbotä¸ºç½‘ç«™é…ç½®httpsé“¾æ¥</a><time datetime="2021-04-13T01:26:27.000Z" title="å‘è¡¨äº 2021-04-13 09:26:27">2021-04-13</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Nebulaoc</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a href="icpéˆæ¥"><img class="icp-icon" src="icpåœ–ç‰‡"><span>å‚™æ¡ˆè™Ÿï¼šxxxxxx</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/algolia.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>